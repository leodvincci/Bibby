package com.penrose.bibby.library.cataloging.author.infrastructure.entity;

import static org.junit.jupiter.api.Assertions.*;

import com.penrose.bibby.library.cataloging.book.infrastructure.entity.BookEntity;
import java.util.HashSet;
import java.util.Set;
import org.junit.jupiter.api.Test;

class AuthorEntityTest {

  /**
   * Tests the default no-args constructor of AuthorEntity. Verifies that a new instance is created
   * with null values for authorId, firstName, and lastName, and that the books collection is
   * initialized as an empty set.
   */
  @Test
  void testDefaultConstructor() {
    AuthorEntity author = new AuthorEntity();
    assertNotNull(author);
    assertNull(author.getAuthorId());
    assertNull(author.getFirstName());
    assertNull(author.getLastName());
    assertNotNull(author.getBooks());
    assertTrue(author.getBooks().isEmpty());
  }

  /**
   * Tests the parameterized constructor of AuthorEntity. Verifies that firstName and lastName are
   * properly set when passed to the constructor, authorId remains null (as it's generated by JPA),
   * and books collection is initialized empty.
   */
  @Test
  void testParameterizedConstructor() {
    AuthorEntity author = new AuthorEntity("John", "Doe");
    assertNull(author.getAuthorId());
    assertEquals("John", author.getFirstName());
    assertEquals("Doe", author.getLastName());
    assertNotNull(author.getBooks());
    assertTrue(author.getBooks().isEmpty());
  }

  /**
   * Tests all getter and setter methods of AuthorEntity. Verifies that values can be set and
   * retrieved correctly for authorId, firstName, and lastName.
   */
  @Test
  void testGettersAndSetters() {
    AuthorEntity author = new AuthorEntity();

    author.setAuthorId(1L);
    assertEquals(1L, author.getAuthorId());

    author.setFirstName("Jane");
    assertEquals("Jane", author.getFirstName());

    author.setLastName("Smith");
    assertEquals("Smith", author.getLastName());
  }

  /**
   * Tests the toString() method of AuthorEntity. Verifies that the string representation returns
   * the author's full name in the format "firstName lastName".
   */
  @Test
  void testToString() {
    AuthorEntity author = new AuthorEntity("Isaac", "Asimov");
    assertEquals("Isaac Asimov", author.toString());
  }

  /**
   * Tests the many-to-many relationship between AuthorEntity and BookEntity. Verifies that books
   * can be added to an author's collection and retrieved correctly.
   */
  @Test
  void testBooksRelationship() {
    AuthorEntity author = new AuthorEntity("J.K.", "Rowling");
    BookEntity book = new BookEntity("Harry Potter", new HashSet<>());

    Set<BookEntity> books = new HashSet<>();
    books.add(book);

    author.setBooks(books);

    assertEquals(1, author.getBooks().size());
    assertTrue(author.getBooks().contains(book));
  }

  /**
   * Tests that getBooks() returns the correct type without casting issues. Verifies that the
   * returned value is not null and is an instance of Set, confirming the fix for the redundant cast
   * warning.
   */
  @Test
  void testGetBooksReturnsCorrectType() {
    AuthorEntity author = new AuthorEntity();
    Set<BookEntity> books = author.getBooks();

    assertNotNull(books);
    assertTrue(books instanceof Set);
  }
}
